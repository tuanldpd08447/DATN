@using Newtonsoft.Json
@{
    var khachHangsJson = JsonConvert.SerializeObject(ViewBag.KhachHangs);
    var khachHangPreoderJson = JsonConvert.SerializeObject(ViewBag.KhachHangPreorder);
    List<string> _danTocList = new List<string>
    {
        "Kinh", "Tày", "Mường", "Mông", "H'mông", "Khmer", "Hoa", "Nùng", "Thái",
        "Dzao", "Cờ Lao", "Gian", "Ê Đê", "Ba Na", "Sán Dìu", "Sán Chay", "Cơ Tu",
        "Sơ Đăng", "Tà Ôi", "Pà Thẻn", "Hà Nhì", "Chứt", "Lào", "Lự", "Tày",
        "Chăm", "Dẻo", "Bố Y", "Rơ Măm", "Ra Glai", "Sak", "Xinh Mun", "Xơ Đăng",
        "Bình Định", "Tày", "Tày", "Tày", "Chơ", "Chống", "Gieo", "Mai", "Gia Rai",
        "Kon Tum", "Đồng Tháp", "Gyar", "Lý Tự", "Tư", "Chứt", "Vân Kiều"
    };

    var tg = DateOnly.FromDateTime(DateTime.Now);
  
}
<style>
    .error-message {
        color: red;
        font-size: 12px;
        display: none;
    }

    .input-error {
        border-color: red;
    }
</style>
        <div class="container mt-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="" style="color: #2fb388;">QUẢN LÝ TIẾP NHẬN</h2>
            <div class="Double-end ">
            <button class="btn fw-bold custom-btn" id="addButton">
                <i class="fa-solid fa-plus"></i> Thêm
            </button>
            <button class="btn fw-bold custom-btn" id="activateButton" disabled>
                    <i class="fa-solid fa-floppy-disk"></i> Lưu
                 </button>
            <button class="btn fw-bold custom-btn" id="CancelButton">
                <i class="fa-solid fa-xmark"></i> Hủy
            </button>
                <button class="btn fw-bold custom-btn"><i class="fa-solid fa-right-from-bracket"></i> Thoát</button>
              </div>
        </div>
      
      <!-- Thông tin hóa đơn -->
    <div class="row m-0 mb-3 border rounded-4 py-2  ">
        <div class="invoice-section col-md-12  ">
            <div class=" p-3 border rounded-4  ">
                <div class="row ">
                    <form id="customerForm" asp-action="AddKhachHang" asp-controller="QLTiepNhan" onsubmit="return validateForm()">
                        <div class="row">
               
                            <div class="form-group col">
                                <label class="fw-semibold" for="hoTen">Họ tên</label>
                                <input type="text" class="form-control" id="hoTen" name="hoTen" placeholder="Nhập họ tên" oninput="validateHoTen()" required disabled>
                                <span id="hoTenError" class="error-message"></span>
                                <script>
                                    function validateHoTen() {
                                        var hoTen = document.getElementById('hoTen').value.trim();
                                        var errorElement = document.getElementById('hoTenError');

                                        if (hoTen === "") {
                                            errorElement.textContent = "Họ tên không được để trống!";
                                            errorElement.style.display = 'block';
                                            document.getElementById('hoTen').classList.add('input-error');
                                        } else if (hoTen.length < 6) {
                                            errorElement.textContent = "Họ tên phải có ít nhất 6 ký tự!";
                                            errorElement.style.display = 'block';
                                            document.getElementById('hoTen').classList.add('input-error');
                                        } else {
                                            errorElement.textContent = "";
                                            errorElement.style.display = 'none';
                                            document.getElementById('hoTen').classList.remove('input-error');
                                        }
                                    }
                                </script>
                            </div>
                            <div class="form-group col">
                                <label class="fw-semibold" for="ngaySinh">Ngày sinh</label>
                                <input type="date" class="form-control" name="ngaySinh" id="ngaySinh" onchange="validatedate()" required disabled>
                                <span id="ngaySinhError" class="error-message" style="display: none; color: red;"></span>

                                <script>
                                    function validatedate() {
                                        var ngaySinh = document.getElementById('ngaySinh').value.trim();
                                        var errorElement = document.getElementById('ngaySinhError');

                                        // Kiểm tra nếu trường ngày sinh để trống
                                        if (ngaySinh === "") {
                                            errorElement.textContent = "Ngày sinh không được để trống!";
                                            errorElement.style.display = "inline";  // Hiển thị thông báo lỗi
                                            return; // Dừng kiểm tra tiếp theo nếu có lỗi
                                        }

                                        var currentDate = new Date();
                                        var inputDate = new Date(ngaySinh);

                                        // Kiểm tra nếu ngày sinh là ngày trong tương lai
                                        if (inputDate > currentDate) {
                                            errorElement.textContent = "Ngày sinh không thể là ngày trong tương lai!";
                                            errorElement.style.display = "inline";  // Hiển thị thông báo lỗi
                                            return; // Dừng kiểm tra tiếp theo nếu có lỗi
                                        }

                                        // Kiểm tra nếu ngày sinh không hợp lệ
                                        if (isNaN(inputDate.getTime())) {
                                            errorElement.textContent = "Ngày sinh không hợp lệ!";
                                            errorElement.style.display = "inline";  // Hiển thị thông báo lỗi
                                            return; // Dừng kiểm tra tiếp theo nếu có lỗi
                                        }

                                        // Nếu tất cả kiểm tra đều hợp lệ
                                        errorElement.textContent = "";  // Xóa thông báo lỗi
                                        errorElement.style.display = "none";   // Ẩn thông báo lỗi
                                    }
                                </script>
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group col">
                                <label class="fw-semibold" for="danToc">Dân tộc</label>
                                <select class="form-control" id="danToc" name="danToc" required disabled>
                                    <option value="">Chọn dân tộc</option>
                                    @foreach (var danToc in _danTocList)
                                    {
                                        <option value="@danToc">@danToc</option>
                                    }
                                </select>
                                <span id="danTocError" class="error-message" style="color:red; display:none;">Vui lòng chọn dân tộc!</span>
                            </div>

                            <div class="form-group col">
                                <label class="fw-semibold" for="gioiTinh">Giới tính</label>
                                <select class="form-control" id="gioiTinh" name="gioiTinh" required disabled>
                                    <option value="Nam">Nam</option>
                                    <option value="Nữ">Nữ</option>
                                </select>
                            </div>
                            <div class="form-group col">
                                <label class="fw-semibold" for="cmt">CMT/CCCD/Mã định danh</label>
                                <input type="text" class="form-control" id="cmt" name="cmt" placeholder="Nhập số CMT/CCCD" oninput="validateCMT()" required disabled>
                                <span id="cmtError" class="error-message"></span>
                                <script>
                                    function validateCMT() {
                                        var cmt = document.getElementById('cmt').value.trim();
                                        var cmtPattern = /^[0-9]{12}$/; // Phải gồm đúng 12 chữ số
                                        var errorElement = document.getElementById('cmtError');

                                        if (!cmtPattern.test(cmt)) {
                                            errorElement.textContent = "CMT/CCCD phải gồm đúng 12 chữ số!";
                                            document.getElementById('cmt').classList.add('input-error');
                                            errorElement.style.display = 'block';
                                        } else {
                                            errorElement.textContent = "";
                                            document.getElementById('cmt').classList.remove('input-error');
                                            errorElement.style.display = 'none';
                                        }
                                    }
                                </script>
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group col">
                                <label class="fw-semibold" for="sdt">Sđt</label>
                                <input type="text" class="form-control" id="sdt" name="sdt" oninput="validatePhoneNumber()" placeholder="Nhập số điện thoại" required disabled>
                                <span id="sdtError" class="error-message"></span>
                                <script>
                                    function validatePhoneNumber() {
                                        var phone = document.getElementById('sdt').value;
                                        var phonePattern = /^[0-9]{10}$/; 
                                        var errorElement = document.getElementById('sdtError');

                                        if (!phonePattern.test(phone)) {
                                            document.getElementById('sdt').classList.add('input-error');
                                            errorElement.textContent = "Số điện thoại phải có 10 chữ số.";
                                            errorElement.style.display = 'block';
                                        } else {
                                            document.getElementById('sdt').classList.remove('input-error');
                                            errorElement.style.display = 'none';
                                        }
                                    }

                                </script>
                            </div>
                            <div class="form-group col">
                                <label class="fw-semibold" for="email">Email</label>
                                <input type="email" class="form-control" id="email" name="email" placeholder="Nhập email" oninput="validateEmail()" required disabled>
                                <span id="emailError" class="error-message" style="display: none;"></span> <!-- Thêm thẻ span để hiển thị lỗi -->
                            </div>

                            <script src="~/js/EmaiVali.js" asp-append-version="true"></script>
                        </div>
                        <h5 class="mt-2">Hộ khẩu</h5>
                        <div class="row">
                            <div class="form-group col">
                                <label class="fw-semibold" for="hoKhauTinh">Tỉnh/TP</label>
                                <select class="form-control" id="hoKhauTinh" required disabled>
                                    <option value="">-- Chọn Tỉnh/TP --</option>
                                </select>
                                <span id="hoKhauTinhError" class="error-message" style="color:red; display:none;">Vui lòng chọn Tỉnh/TP!</span>
                            </div>
                            <div class="form-group col">
                                <label class="fw-semibold" for="hoKhauQuan">Quận/Huyện</label>
                                <select class="form-control" id="hoKhauQuan" required disabled>
                                    <option value="">-- Chọn Quận/Huyện --</option>
                                </select>
                                <span id="hoKhauQuanError" class="error-message" style="color:red; display:none;">Vui lòng chọn Quận/Huyện!</span>
                            </div>
                            <div class="form-group col">
                                <label class="fw-semibold" for="hoKhauXa">Xã/Phường</label>
                                <select class="form-control" id="hoKhauXa" name="hoKhauXa" required disabled>
                                    <option value="">-- Chọn Xã/Phường --</option>
                                </select>
                                <span id="hoKhauXaError" class="error-message" style="color:red; display:none;">Vui lòng chọn Xã/Phường!</span>
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group col">
                                <label class="fw-semibold" for="diaChiChiTiet">Địa chỉ chi tiết</label>
                                <input type="text" class="form-control" name="diaChiChiTiet" id="diaChiChiTiet" placeholder="Nhập địa chỉ chi tiết" required disabled>
                                <span id="diaChiChiTietError" class="error-message" style="color:red; display:none;">Địa chỉ chi tiết không được để trống!</span>
                            </div>
                        </div>

                      
                        
                        <button id="targetButton" type="submit" style="display:none;">Nút bị kích hoạt</button>
                        
                        <script type="module" src="~/js/site.js" asp-append-version="true"></script>
                        <script>
                                function validateForm(event) {
                                    var valid = true;

                                    // Kiểm tra Họ tên
                                    var hoTen = document.getElementById('hoTen').value.trim();
                                    var hoTenError = document.getElementById('hoTenError');
                                    if (hoTen === "") {
                                        hoTenError.textContent = "Họ tên không được để trống!";
                                        hoTenError.style.display = 'block';
                                        document.getElementById('hoTen').classList.add('input-error');
                                        valid = false;
                                    } else if (hoTen.length < 6) {
                                        hoTenError.textContent = "Họ tên phải có ít nhất 6 ký tự!";
                                        hoTenError.style.display = 'block';
                                        document.getElementById('hoTen').classList.add('input-error');
                                        valid = false;
                                    } else {
                                        hoTenError.textContent = "";
                                        hoTenError.style.display = 'none';
                                        document.getElementById('hoTen').classList.remove('input-error');
                                    }

                                    // Kiểm tra Ngày sinh
                                    var ngaySinh = document.getElementById('ngaySinh').value.trim();
                                    var ngaySinhError = document.getElementById('ngaySinhError');
                                    if (ngaySinh === "") {
                                        ngaySinhError.textContent = "Ngày sinh không được để trống!";
                                        ngaySinhError.style.display = 'block';
                                    document.getElementById('ngaySinh').classList.add('input-error');
                                        valid = false;
                                    } else {
                                        var currentDate = new Date();
                                        var inputDate = new Date(ngaySinh);
                                        if (inputDate > currentDate) {
                                            ngaySinhError.textContent = "Ngày sinh không thể là ngày trong tương lai!";
                                            ngaySinhError.style.display = 'block';
                                        document.getElementById('ngaySinh').classList.add('input-error');
                                            valid = false;
                                        } else {
                                            ngaySinhError.textContent = "";
                                            ngaySinhError.style.display = 'none';
                                        document.getElementById('ngaySinh').classList.remove('input-error');
                                        }
                                    }
                                    if (!validateEmailSumit()) {  // Gọi validateEmail và nếu nó trả về false thì valid = false
                                        valid = false;
                                    }
                                    // Kiểm tra CMT/CCCD
                                    var cmt = document.getElementById('cmt').value.trim();
                                    var cmtPattern = /^[0-9]{12}$/; // Phải gồm đúng 12 chữ số
                                    var cmtError = document.getElementById('cmtError');
                                    if (!cmtPattern.test(cmt)) {
                                        cmtError.textContent = "CMT/CCCD phải gồm đúng 12 chữ số!";
                                        cmtError.style.display = 'block';
                                        document.getElementById('cmt').classList.add('input-error');
                                        valid = false;
                                    } else {
                                        cmtError.textContent = "";
                                        cmtError.style.display = 'none';
                                        document.getElementById('cmt').classList.remove('input-error');
                                    }

                                    // Kiểm tra Số điện thoại
                                    var phone = document.getElementById('sdt').value.trim();
                                    var phonePattern = /^[0-9]{10}$/;
                                    var sdtError = document.getElementById('sdtError');
                                    if (!phonePattern.test(phone)) {
                                        sdtError.textContent = "Số điện thoại phải có 10 chữ số.";
                                        sdtError.style.display = 'block';
                                        document.getElementById('sdt').classList.add('input-error');
                                        valid = false;
                                    } else {
                                        sdtError.textContent = "";
                                        sdtError.style.display = 'none';
                                        document.getElementById('sdt').classList.remove('input-error');
                                    }

                                    // Kiểm tra Dân tộc
                                    var danToc = document.getElementById('danToc').value;
                                    var danTocError = document.getElementById('danTocError');
                                    if (danToc === "") {
                                        danTocError.textContent = "Dân tộc không được để trống!";
                                        danTocError.style.display = 'block';
                                        document.getElementById('danToc').classList.add('input-error');
                                        valid = false;
                                    } else {
                                        danTocError.textContent = "";
                                        danTocError.style.display = 'none';
                                        document.getElementById('danToc').classList.remove('input-error');
                                    }

                                    // Kiểm tra Tỉnh/TP
                                    var hoKhauTinh = document.getElementById('hoKhauTinh').value;
                                    var hoKhauTinhError = document.getElementById('hoKhauTinhError');
                                    if (hoKhauTinh === "") {
                                        hoKhauTinhError.textContent = "Tỉnh/TP không được để trống!";
                                        hoKhauTinhError.style.display = 'block';
                                        document.getElementById('hoKhauTinh').classList.add('input-error');
                                        valid = false;
                                    } else {
                                        hoKhauTinhError.textContent = "";
                                        hoKhauTinhError.style.display = 'none';
                                        document.getElementById('hoKhauTinh').classList.remove('input-error');
                                    }

                                    // Kiểm tra Quận/Huyện
                                    var hoKhauQuan = document.getElementById('hoKhauQuan').value;
                                    var hoKhauQuanError = document.getElementById('hoKhauQuanError');
                                    if (hoKhauQuan === "") {
                                        hoKhauQuanError.textContent = "Quận/Huyện không được để trống!";
                                        hoKhauQuanError.style.display = 'block';
                                        document.getElementById('hoKhauQuan').classList.add('input-error');
                                        valid = false;
                                    } else {
                                        hoKhauQuanError.textContent = "";
                                        hoKhauQuanError.style.display = 'none';
                                        document.getElementById('hoKhauQuan').classList.remove('input-error');
                                    }

                                    // Kiểm tra Xã/Phường
                                    var hoKhauXa = document.getElementById('hoKhauXa').value;
                                    var hoKhauXaError = document.getElementById('hoKhauXaError');
                                    if (hoKhauXa === "") {
                                        hoKhauXaError.textContent = "Xã/Phường không được để trống!";
                                        hoKhauXaError.style.display = 'block';
                                        document.getElementById('hoKhauXa').classList.add('input-error');
                                        valid = false;
                                    } else {
                                        hoKhauXaError.textContent = "";
                                        hoKhauXaError.style.display = 'none';
                                        document.getElementById('hoKhauXa').classList.remove('input-error');
                                    }

                                    // Kiểm tra Địa chỉ chi tiết
                                    var diaChiChiTiet = document.getElementById('diaChiChiTiet').value.trim();
                                    var diaChiChiTietError = document.getElementById('diaChiChiTietError');
                                    if (diaChiChiTiet === "") {
                                        diaChiChiTietError.textContent = "Địa chỉ chi tiết không được để trống!";
                                        diaChiChiTietError.style.display = 'block';
                                        document.getElementById('diaChiChiTiet').classList.add('input-error');
                                        valid = false;
                                    } else {
                                        diaChiChiTietError.textContent = "";
                                        diaChiChiTietError.style.display = 'none';
                                        document.getElementById('diaChiChiTiet').classList.remove('input-error');
                                    }

                                    // Kiểm tra các trường khác nếu cần...

                                  

                                    return valid;
                                }
                        </script>

                    </form>


                </div>  
                 
            </div>
            <form asp-action="AddHangCho" asp-controller="QLTiepNhan" style="display:none;" method="post">
                <input type="AddHangCho" id="idinput" name="IDKH" value=""  required>

                <button id="AddSumit" type="submit" style="display:none;">Nút bị kích hoạt</button>
                </form>
            <div class="p-2 mt-2 border rounded-4 float-end" style="width: 35%;" >  
                    <div >
                        <button type="button" class="btn custom-btn rounded-pill font-weight-bold" data-bs-toggle="modal" data-bs-target="#vaccineModal" style="width: 100%;">Thêm hàng chờ</button>
                    </div>
                    <div class="modal fade" id="vaccineModal" tabindex="-1" aria-labelledby="vaccineModalLabel" >
                        <div class="modal-dialog modal-xl">
                            <div class="modal-content">
                                <!-- Header Modal -->
                                <div class="modal-header">
                                    <h5 class="modal-title" id="vaccineModalLabel">THÊM HÀNG CHỜ</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                
                                <!-- Body Modal -->
                                <div class="modal-body" style="overflow-x: auto; max-height: 80vh;">
                                    <!-- Form tìm kiếm -->
                                    <div class="border rounded-4 p-3 mt-2">
                                    <form class="row g-3">
                                        <div class="col-3">
                                            <label class="fw-bold" for="medicalCodeFind">Số y tế</label>
                                            <input type="text" class="form-control" id="medicalCodeFind" placeholder="Nhập số y tế">
                                        </div>

                                        <div class="col">
                                            <label class="fw-bold" for="userNameFind">Tên bệnh nhân</label>
                                            <input type="text" class="form-control" id="userNameFind" placeholder="Nhập tên bệnh nhân">
                                        </div>

                                        <div class="col">
                                            <label class="fw-bold" for="identityCodeFind">CMT/CCCD/Mã định danh</label>
                                            <input type="text" class="form-control" id="identityCodeFind" placeholder="Nhập mã định danh">
                                        </div>

                                        <div class="col-2">
                                            <button class="btn custom-btn mt-4 w-100" type="button" id="searchButton">
                                                <i class="fa-solid fa-magnifying-glass"></i> Tìm
                                            </button>
                                        </div>
                                    </form>
                                    </div>
                    
                                    <!-- Bảng hẹn đặt trước -->
                                    <div class="border rounded-4 mt-4 p-3 table-responsive" style="font-size: small;">
                                    <h4>Bảng hẹn đặt trước: Ngày @tg.ToString("dd/MM/yyyy")</h4>
                                    <table class="table table-bordered" id="khachHangPreoderTable">
                                            <thead >
                                                <tr style="background-color: #2fb388;">
                                                    <th></th>
                                                    <th>ID</th>
                                                    <th>Ngày đặt</th>
                                                    <th>Giờ Hẹn</th>
                                                    <th>Tên Khách Hàng</th>
                                                    <th>Ngày Sinh</th>
                                                    <th>Giới Tính</th>
                                                    <th>Địa Chỉ</th>
                                                    <th>Số Điện Thoại</th>
                                                    <th>Email</th>
                                                    <th>CCCD/MD</th>
                                                    <th>Dân Tộc</th>
                                                    <th>Địa Chỉ Đầy Đủ</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                
                                            </tbody>
                                        </table>
                                    </div>
                    
                                    <!-- Bảng thông tin khách hàng -->
                                    <div class="border rounded-4 mt-4 p-3 table-responsive" style="font-size: small;">
                                        <h4>Bảng thông tin khách hàng</h4>
                                    <table class="table table-bordered" id="khachHangTable">
                                        <thead>
                                            <tr>
                                                <th></th>
                                                <th>ID</th>
                                                <th>Tên Khách Hàng</th>
                                                <th>Ngày Sinh</th>
                                                <th>Giới Tính</th>
                                                <th>Địa Chỉ</th>
                                                <th>Số Điện Thoại</th>
                                                <th>Email</th>
                                                <th>CCCD/MD</th>
                                                <th>Dân Tộc</th>
                                                <th>Địa Chỉ Đầy Đủ</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                           
                                        </tbody>
                                        </table>
                                    </div>
                                </div>

                        

                                <!-- Footer Modal -->
                                <div class="modal-footer">
                                <button type="button" class="btn btn-outline-danger border-2" data-bs-dismiss="modal">Thoát</button>
                                <button type="button" class="btn custom-btn" id="sumitadd" >Thêm hàng chờ</button>
                                </div>
                            </div>
                        </div>
                    </div>
            </div>  
        </div>
      
       
    </div>
    

  
</div>
<script>

        // Khởi tạo dữ liệu từ server với giá trị mặc định là mảng rỗng
        const khachHangs = @Html.Raw(khachHangsJson ?? "null") || [];
    const khachHangPreoder = @Html.Raw(khachHangPreoderJson ?? "null") || [];

    // Hàm để render lại bảng với dữ liệu mới
    function renderTable(data) {
        const tbody = document.querySelector("#khachHangTable tbody");
        tbody.innerHTML = ''; // Xóa dữ liệu cũ

        if (!Array.isArray(data) || data.length === 0) {
            // Hiển thị thông báo khi không có dữ liệu
            tbody.innerHTML = `
                    <tr>
                        <td class="text-center fw-semibold" colspan="12">Không tìm thấy dữ liệu cần tìm</td>
                    </tr>
                `;
            return;
        }

        const fragment = document.createDocumentFragment();

        data.forEach(kh => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
                    <td RadioCell${kh.IDKH}>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="RadioKhachHang" id="Radio${kh.IDKH}" onchange="AddHangCho('${kh.IDKH}')" value="${kh.IDKH}">
                        </div>
                    </td>
                    <td id="IDKHCell${kh.IDKH}">${kh.IDKH}</td>
                    <td id="TenKhachHangCell${kh.IDKH}">${kh.TenKhachHang}</td>
                    <td id="NgaySinhCell${kh.IDKH}">
                        ${kh.NgaySinh ? new Date(kh.NgaySinh).toLocaleDateString('vi-VN') : ''}
                    </td>
                    <td id="GioiTinhCell${kh.IDKH}">${kh.GioiTinh || ''}</td>
                    <td id="DiaChiCell${kh.IDKH}">${kh.DiaChi || ''}</td>
                    <td id="SoDienThoaiCell${kh.IDKH}">${kh.SoDienThoai || ''}</td>
                    <td id="EmailCell${kh.IDKH}">${kh.Email || ''}</td>
                    <td id="CCCD_MDDCell${kh.IDKH}">${kh.CCCD_MDD || ''}</td>
                    <td id="DanTocCell${kh.IDKH}">${kh.DanToc || ''}</td>
                    <td id="FullAddressCell${kh.IDKH}">${kh.FullAddress || ''}</td>
                `;
            fragment.appendChild(tr);
        });

        tbody.appendChild(fragment);
    }

    function renderKhachHangPreoderTable(data) {
        const tbody = document.querySelector("#khachHangPreoderTable tbody");
        tbody.innerHTML = ''; // Xóa dữ liệu cũ

        if (!Array.isArray(data) || data.length === 0) {
            tbody.innerHTML = `
                    <tr>
                        <td colspan="13" class="text-center">Không có lịch hẹn nào</td>
                    </tr>
                `;
            return;
        }

        const fragment = document.createDocumentFragment();

        data.forEach(order => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
                    <td id="RadioCell${order.IDKH}">
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="RadioKhachHang" id="Radio${order.IDKH}" onchange="AddHangCho('${order.IDKH}')" value="${order.IDKH}">
                        </div>
                    </td>
                    <td id="IDKHCell${order.IDKH}">${order.IDKH}</td>
                    <td id="NgayHenCell${order.IDKH}">${order.NgayHen}</td>
                    <td id="ThoiGianHenCell${order.IDKH}">${order.ThoiGianHen}</td>
                    <td id="TenKhachHangCell${order.IDKH}">${order.TenKhachHang}</td>
                    <td id="NgaySinhCell${order.IDKH}">
                        ${order.NgaySinh ? new Date(order.NgaySinh).toLocaleDateString('vi-VN') : ''}
                    </td>
                    <td id="GioiTinhCell${order.IDKH}">${order.GioiTinh || ''}</td>
                    <td id="DiaChiCell${order.IDKH}">${order.DiaChi || ''}</td>
                    <td id="SoDienThoaiCell${order.IDKH}">${order.SoDienThoai || ''}</td>
                    <td id="EmailCell${order.IDKH}">${order.Email || ''}</td>
                    <td id="CCCD_MDDCell${order.IDKH}">${order.CCCD_MDD || ''}</td>
                    <td id="DanTocCell${order.IDKH}">${order.DanToc || ''}</td>
                    <td id="FullAddressCell${order.IDKH}">${order.FullAddress || ''}</td>
                `;
            fragment.appendChild(tr);
        });

        tbody.appendChild(fragment);
    }

    // Hàm tìm kiếm
    document.getElementById('searchButton').addEventListener('click', function () {
        const medicalCode = document.getElementById('medicalCodeFind').value.trim().toLowerCase();
        const userName = document.getElementById('userNameFind').value.trim().toLowerCase();
        const identityCode = document.getElementById('identityCodeFind').value.trim().toLowerCase();

        const filteredData = Array.isArray(khachHangs)
            ? khachHangs.filter(kh => (
                (medicalCode === '' || (kh.IDKH && kh.IDKH.toLowerCase().includes(medicalCode))) &&
                (userName === '' || (kh.TenKhachHang && kh.TenKhachHang.toLowerCase().includes(userName))) &&
                (identityCode === '' || (kh.CCCD_MDD && kh.CCCD_MDD.toLowerCase().includes(identityCode)))
            ))
            : [];

        const filteredData2 = Array.isArray(khachHangPreoder)
            ? khachHangPreoder.filter(kh => (
                (medicalCode === '' || (kh.IDKH && kh.IDKH.toLowerCase().includes(medicalCode))) &&
                (userName === '' || (kh.TenKhachHang && kh.TenKhachHang.toLowerCase().includes(userName))) &&
                (identityCode === '' || (kh.CCCD_MDD && kh.CCCD_MDD.toLowerCase().includes(identityCode)))
            ))
            : [];

        renderTable(filteredData);
        renderKhachHangPreoderTable(filteredData2);
    });

    // Hiển thị dữ liệu mặc định khi tải trang
    renderTable(khachHangs);
    renderKhachHangPreoderTable(khachHangPreoder);


    // Xử lý sự kiện khi nhấn nút "Thêm"
    document.getElementById("addButton").addEventListener("click", function () {
        // Lấy form
        const form = document.getElementById("customerForm");
        const activateButton = document.getElementById('activateButton');

        // Thực hiện kích hoạt lại các trường input và select trong form
        const inputs = form.querySelectorAll("input");
        const selects = form.querySelectorAll("select");

        // Kích hoạt tất cả các trường input
        inputs.forEach(input => {
            input.disabled = false; 
            // Bỏ thuộc tính disabled
        });

        // Kích hoạt tất cả các trường select
        selects.forEach(select => {
            select.disabled = false;  // Bỏ thuộc tính disabled
        });

        activateButton.disabled = false;
    });

    document.getElementById("CancelButton").addEventListener("click", function () {
        // Lấy form
        const form = document.getElementById("customerForm");
        const activateButton = document.getElementById('activateButton');
        const addButton = document.getElementById("addButton")
        // Thực hiện kích hoạt lại các trường input và select trong form
        const inputs = form.querySelectorAll("input");
        const selects = form.querySelectorAll("select");

        // Kích hoạt tất cả các trường input và làm trống chúng
        inputs.forEach(input => {
            input.value = ""; // Làm trống nội dung
            input.disabled = true;  // Thêm thuộc tính disabled
        });

        // Kích hoạt tất cả các trường select và đặt về giá trị mặc định
        selects.forEach(select => {
            select.selectedIndex = 0; // Đặt về tùy chọn đầu tiên (thường là tùy chọn mặc định)
            select.disabled = true;  // Thêm thuộc tính disabled
        });
        addButton.disabled = false;
        activateButton.disabled = true;
    });


    // Lấy phần tử button
    const activateButton = document.getElementById('activateButton');
    const targetButton = document.getElementById('targetButton');

    // Thêm sự kiện click vào nút kích hoạt
    activateButton.addEventListener('click', function () {
        targetButton.click();
    });

   

    let selectedID = null;

    function AddHangCho(id) {
        selectedID = id;
        document.getElementById('idinput').value = id;
        console.log("Selected ID:", id);
    }

    document.addEventListener('DOMContentLoaded', function () {
        const sumitadd = document.getElementById('sumitadd');
        const AddSumit = document.getElementById('AddSumit');

        if (sumitadd && AddSumit) {
            sumitadd.addEventListener('click', function () {
                AddSumit.click();
            });
        } else {
            console.error("Không tìm thấy một trong hai phần tử: 'sumitadd' hoặc 'AddSumit'");
        }
    });



</script>
