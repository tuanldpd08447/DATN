@{
    var vattu =  ViewBag.vatTuYTe as List<VatTuDTO>;
    var ChungTu = ViewBag.chungTu as ChungTuDetail;
    var loaivattu =  ViewBag.loaivattu as List<LoaivatTu>;
    var nguoncap = ViewBag.NguonCap as List<NguonCungCap>;
    var nhacap =ViewBag.NhaCap as List<NhaCungCap>;
    DateTime TimeNow = DateTime.Now;
    var ListChungTu = ViewBag.ListChungTu as List<ChungTuDetail>;
    var ListXuatSu = ViewBag.ListXuatSu as List<XuatXu>;
    string newIDCT = ViewBag.IDCTNew as string;

}
  <div class="container mt-4" >
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="" style="color: #2fb388;">QUẢN LÝ XUẤT NHẬP KHO</h2>
            <div class="Double-end ">
                <button class="btn fw-bold custom-btn"><i class="fa-solid fa-plus"></i> Thêm</button>
                <button class="btn fw-bold custom-btn"><i class="fa-solid fa-floppy-disk"></i> Lưu</button>
                <button class="btn fw-bold custom-btn"><i class="fa-solid fa-repeat"></i> Hủy </button>
                <button class="btn fw-bold custom-btn"><i class="fa-solid fa-print"></i> In</button>
                <button class="btn fw-bold custom-btn"><i class="fa-solid fa-right-from-bracket"></i> Thoát</button>
              </div>
        </div>
      
      <!-- Thông tin hóa đơn -->
    <div class="row m-0 mb-3 border rounded-4 py-2  ">
        <div class="col">
            <div class=" ms-1 p-3 py-1 border rounded-4  h-100">
                <div class="row ">
                    <div class="border rounded-4 p-2 ">
                        <form class="row ">
                            <div class="col ps-5">
                                <div class="form-group">
                                    <label for="ticketNumberFind">Số Phiếu</label>
                                    <input type="text" class="form-control" id="ticketNumberFind" value="24URAD036">
                                </div>
                            </div>
                            <div class="col">
                                <div class="form-group">
                                    <label for="TypeFind">Loại</label>
                                    <select type="text" class="form-control" id="TypeFind">
                                    </select>
                                </div>
                            </div>
                            <div class="col">
                                <div class="form-group">
                                    <label for="productionDateFind">Ngày Xuất/Nhập</label>
                                    <input type="date" class="form-control" id="productionDateFind" value="2023-02-03">
                                </div>
                            </div class="col">
                           
                            <div class="col">
                                <button class="btn fw-bold custom-btn mt-4" type="button"><i class="fa-solid fa-magnifying-glass"></i>  Tìm</button>
                            </div>
                        </form>
                    </div>
                    <form class="my-3 row">
                        <div class="col-3">
                            <div class="form-group row mt-4">
                                <label class="col-4 pt-1" for="ticketNumberFind">Số Phiếu</label>
                                <input type="text" class="form-control col" id="ticketNumberFind" value="@if(ChungTu!=null){@ChungTu.IDXCT}">
                            </div>
                            <div >
                                <button type="button" class="btn custom-btn rounded-pill px-3 py-2 mt-4 ms-5 fw-bold" data-bs-toggle="modal" data-bs-target="#VatTuModal">
                                    LẬP PHIẾU XUẤT/NHẬP
                                 </button>
                                 @if(ChungTu != null && ChungTu.TrangThai ){
                                    <button type="button" class="btn btn-outline-danger border-2 rounded-pill px-3 py-2 mt-4 ms-5 fw-bold" data-bs-toggle="modal" data-bs-target="#confirmCancelModal">
                                    HỦY PHIẾU XUẤT/NHẬP
                                 </button>
                                }

                            </div>
                             
                           
                        </div>
                        <div class="col">
                            <div class="row">
                                <div class="form-group col">
                                    <label for="VatTuCode">Mã vật tư</label>
                                    <input type="text" class="form-control" id="VatTuCode" placeholder="Nhập mã vật tư" value="@if(ChungTu!=null){@ChungTu.IDVT}">
                                </div>
                                <div class="form-group col">
                                    <label for="VatTuName">Tên vật tư</label>
                                    <input type="text" class="form-control" id="VatTuName" placeholder="Nhập tên vật tư" value="@if(ChungTu!=null){@ChungTu.TenVatTu}">
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="form-group col">
                                    <label for="VatTuType">Loại vật tư</label>
                                   <select class="form-control" id="VatTuType" >
                                         @if (loaivattu != null)
                                         {
      
                                             @foreach(var item in loaivattu)
                                             {
                                                 @if(ChungTu != null && ChungTu.IDTL == item.IDTL)
                                                 {
                
                                                  <option value="@item.IDTL" selected >@item.LoaiVatTu</option>
                                                 }
                                                 else
                                                 {
                 
                                                     <option value="@item.IDTL" >@item.LoaiVatTu</option>
                                                 }
                                             }
                                         }
    
                                     </select>
                                </div>
                                <div class="form-group col">
                                    <label for="origin">Nguồn cung cấp</label>
                                   <select class="form-control" id="origin">
                                            <option ></option>
                                             @if (nguoncap != null)
                                            {
                                                @foreach( var item in nguoncap)
                                                {
                        
                                                    @if(ChungTu != null && ChungTu.IDNGC == item.IDNGC)
                                                    {
                                                          <option></option>
                                                     <option value="@item.IDNGC" selected >@item.TenNguonCungCap</option>
                                                    }
                                                    else
                                                    {
                            
                                                        <option value="@item.IDNGC" >@item.TenNguonCungCap</option>
                                                    }
                      
                
                                                }}
                                        </select>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="form-group col">
                                    <label for="supplier">Nhà cung cấp</label>
                                      <select class="form-control" id="supplier" placeholder="Nhập nhà cung cấp vật tư">
                                         <option ></option>
                                           @if (nhacap != null)
                                         {
                                             @foreach( var item in nhacap)
                                             {
                                                  @if(ChungTu != null && ChungTu.IDNHC == item.IDNHC)
                                                 {
                   
                                                         <option value="@item.IDNHC" selected> @item.TenNhaCungCap </option>
                                                 }
                                                 else
                                                 {
                 
                                                     <option value="@item.IDNHC" > @item.TenNhaCungCap </option>
                                                 }
          
     
                                             }
                                         }
                                     </select>
                                </div>
                                <div class="form-group col">
                                    <label for="documentType">Loại chứng từ</label>
                                    <select class="form-control" id="documentType">
                                       @if (ChungTu != null)
                                        {
                                            <option value="false" selected="@(ChungTu.LoaiChungTu == false)">Phiếu Xuất</option>
                                            <option value="true" selected="@(ChungTu.LoaiChungTu)">Phiếu Nhập</option>
                                        }
                                        else
                                        {
                                            <option value="false">Phiếu Xuất</option>
                                            <option value="true">Phiếu Nhập</option>
                                        }
                                    </select>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="form-group col">
                                    <label for="quantity">Số lượng xuất/nhập</label>
                                    <input type="number" class="form-control" id="quantity" placeholder="Nhập số lượng" value="@if(ChungTu!=null){@ChungTu.SoLuongXuatNhap}">
                                </div>
                                <div class="form-group col">
                                    <label for="expirationDate">Hạn sử dụng</label>
                                    <input type="date" class="form-control" id="expirationDate" value="@if(ChungTu!=null){@ChungTu.HanSuDung.ToString("yyyy-MM-dd")}">
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="form-group col">
                                    <label for="entryDate">Ngày nhập</label>
                                    <input type="datetime" class="form-control" id="entryDate" value="@if(ChungTu!=null){@ChungTu.ThoiGianXuatNhap.ToString("yyyy-MM-dd HH:mm:ss")}">
                                </div>
                                <div class="form-group col">
                                    <label for="Total">Tổng tiền</label>
                                    <input type="text" class="form-control" id="Total" value="@if(ChungTu!=null){@ChungTu.ThanhTien}" />
                                </div>
                            </div>
                             <div class="row">
                                <div class="form-group col">
                                    <label for="notes">Ghi chú</label>
                                    <textarea class="form-control" id="notes" rows="1" placeholder="Nhập ghi chú" value="@if(ChungTu!=null){@ChungTu.GhiChu}"></textarea>
                                </div>
                                 <div class="form-group col">
                                    <label for="status">Trạng Thái</label>
                                    <select class="form-control" id="status">
                                       @if (ChungTu != null)
                                        {
                                            <option value="true" selected="@(ChungTu.TrangThai )">Hoàn Thành</option>
                                            <option value="false" selected="@(ChungTu.TrangThai == false)">Đã Hủy</option>
                                        }
                                        else
                                        {
                                            <option value="true">Hoàn Thành</option>
                                            <option value="false">Đã Hủy</option>
                                        }
                                    </select>
                                </div>
                            </div>
                        </div>
                    
                    </form>
                    
                    
                </div>
                
            </div>
            
            
        </div>
      
        <div class="p-3 pt-1">
            <div class="border rounded-4 mt-1 ">
                <div class="table-responsive p-2 " style="max-height: 400px; overflow-y: scroll;">
                    <table class="table  m-0 mt-2 ">
                        <thead>
                            <tr>
                                <th>ID Chứng Từ</th>
                                <th>ID Nhân Viên</th>
                                <th>ID Vật Tư</th>
                                <th>Tên Vật Tư</th>
                                <th>Hạn Sử Dụng</th>
                                <th>Đơn Giá</th>
                                <th>Số Lượng Xuất/Nhập</th>
                                <th>Số Lượng Tồn Kho</th>
                                <th>Loại Chứng Từ</th>
                                <th>Thời Gian Xuất Nhập</th>
                                <th>Thành Tiền</th>
                                <th>Trạng Thái</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody>
                           @if(ListChungTu !=null){
                                @foreach (var chungTu in ListChungTu)
                                {
                                    <tr >
                                        <td onclick="location.href='@Url.Action("Clickvaccine", "QLXuatNhapKho", new { IDCT = @chungTu.IDXCT })' ">@chungTu.IDXCT</td>
                                        <td onclick="location.href='@Url.Action("Clickvaccine", "QLXuatNhapKho", new { IDCT = @chungTu.IDXCT })' ">@chungTu.IDNV</td>
                                        <td onclick="location.href='@Url.Action("Clickvaccine", "QLXuatNhapKho", new { IDCT = @chungTu.IDXCT })' ">@chungTu.IDVT</td>
                                        <td onclick="location.href='@Url.Action("Clickvaccine", "QLXuatNhapKho", new { IDCT = @chungTu.IDXCT })' ">@chungTu.TenVatTu</td>
                                        <td onclick="location.href='@Url.Action("Clickvaccine", "QLXuatNhapKho", new { IDCT = @chungTu.IDXCT })' ">@chungTu.HanSuDung.ToString("dd/MM/yyyy")</td>
                                        <td onclick="location.href='@Url.Action("Clickvaccine", "QLXuatNhapKho", new { IDCT = @chungTu.IDXCT })' ">@chungTu.DonGia</td>
                                         <td onclick="location.href='@Url.Action("Clickvaccine", "QLXuatNhapKho", new { IDCT = @chungTu.IDXCT })' ">@chungTu.SoLuongXuatNhap</td>
                                        <td onclick="location.href='@Url.Action("Clickvaccine", "QLXuatNhapKho", new { IDCT = @chungTu.IDXCT })' ">@chungTu.SoLuongTonKho</td>
                                        <td onclick="location.href='@Url.Action("Clickvaccine", "QLXuatNhapKho", new { IDCT = @chungTu.IDXCT })' ">@(chungTu.LoaiChungTu ? "Nhập" : "Xuất")</td>
                                        <td onclick="location.href='@Url.Action("Clickvaccine", "QLXuatNhapKho", new { IDCT = @chungTu.IDXCT })' ">@chungTu.ThoiGianXuatNhap.ToString("dd/MM/yyyy HH:mm")</td>
                                        <td onclick="location.href='@Url.Action("Clickvaccine", "QLXuatNhapKho", new { IDCT = @chungTu.IDXCT })' ">@chungTu.ThanhTien</td>
                                       <td onclick="location.href='@Url.Action("Clickvaccine", "QLXuatNhapKho", new { IDCT = @chungTu.IDXCT })'"
                                            style="color: @(chungTu.TrangThai ? "green" : "red"); font-weight: bold;">
                                            @(chungTu.TrangThai ? "Hoàn Thành" : "Đã Hủy")
                                        </td>
                                        <td>
                                           @if (!string.IsNullOrEmpty(chungTu.HinhAnh))
{
                                               <a onclick="openPdfModal('@Url.Content("~/pdf/" + chungTu.HinhAnh)')" 
                                               class="link-offset-2 link-underline link-underline-opacity-0" 
                                               style="color: #2fb388;">
                                                <i class="fa-solid fa-eye fa-bounce fa-lg"></i> Xem
                                            </a>
   
                                                <a href="@Url.Content("~/pdf/" + chungTu.HinhAnh)" download class="link-offset-2 link-underline link-underline-opacity-0 ms-1" style="color: #2fb388;">
                                                    <i class="fa-solid fa-download fa-bounce fa-lg"></i> Tải xuống
                                                </a>
                                            }
                                            else
                                            {
                                                <span>Không có ảnh</span>
                                            }

                                        </td>
                                    </tr>
                  
                                  
                                }
                            }
                        </tbody>
                    </table>
                 <div class="modal fade" id="pdfModal" tabindex="-1" aria-labelledby="pdfModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg modal-dialog-centered ">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="pdfModalLabel">Xem PDF</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body" style="height: 80vh;">
                                <iframe id="pdfIframe" src="" frameborder="0" style="width: 100%; height: 100%;"></iframe>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                            </div>
                        </div>
                    </div>
                </div>


                    <script>
                       function openPdfModal(pdfUrl) {
                            const pdfIframe = document.getElementById('pdfIframe');
                            pdfIframe.src = pdfUrl; // Đặt nguồn tệp PDF

                            const pdfModal = new bootstrap.Modal(document.getElementById('pdfModal'));
                            pdfModal.show(); // Hiển thị modal
                        }



                    </script>


                </div>
            </div>
        </div>
       
    </div>
        @if (!ViewData.ModelState.IsValid)
    {
        <div class="alert alert-danger">
            <ul>
                @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
                {
                    <li>@error.ErrorMessage</li>
                }
            </ul>
        </div>
    }
     @if(ChungTu != null && ChungTu.TrangThai )
    {
            <div class="modal fade" id="confirmCancelModal" tabindex="-1" aria-labelledby="confirmCancelModalLabel" aria-hidden="true">
       <div class="modal-dialog modal-dialog-centered">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="confirmCancelModalLabel">Xác nhận hủy phiếu @ChungTu.IDXCT</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body">
                                                <p>Bạn có chắc chắn muốn hủy phiếu nhập này không? Thao tác này không thể hoàn tác.</p>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>

                                               <form method="post" asp-action="HuyPhieu" asp-controller="QLXuatNhapKho">
                                                <input type="hidden" name="IDCT" id="modalIDCT" value="@ChungTu.IDXCT">
                                                <button type="submit" class="btn btn-danger">Xác nhận</button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>    
    }
    <div class="modal fade" id="VatTuModal" tabindex="-1" aria-labelledby="VatTuModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="VatTuModalLabel">PHIẾU XUẤT/NHẬP</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mx-4">
                    <form class="row" asp-action="AddChungTu" asp-controller="QLXuatNhapKho" method="post" enctype="multipart/form-data">
                        <div class="col">
                             <input type="hidden" name="IDCT" value="@newIDCT">
                            <input type="hidden" name="NgayXuatNhap" value="@TimeNow.ToString("yyyy-MM-dd HH:mm:ss")">
                            <div class="form-group row mb-1">
                                <label class="col-2 fw-bold" for="soPhieuNhap">Số phiếu</label>
                                <input type="text" class="form-control col" id="soPhieuNhap"  value="@if(newIDCT!=null){@newIDCT}" disabled>
                                <label class="col-2 fw-bold" for="typeName">Loại phiếu</label>
                                <select name="Loaiphieu" class="form-control col" id="typeName">
                                    <option value="false">Phiếu Xuất</option>
                                    <option value="true">Phiếu Nhập</option>
                                </select>
                            </div>
                            <div class="form-group row mb-1">
                                <label class="col-2 fw-bold" for="QuantityXN" >Số lượng xuất/nhập</label>
                                <input type="number" class="form-control col" id="QuantityXN" min="1" name="soLuong" >
                                <label class="col-2 fw-bold" for="importExportDate">Ngày xuất/nhập</label>
                                <input type="datetime" class="form-control col" id="importExportDate" disabled value="@TimeNow.ToString("yyyy-MM-dd HH:mm:ss")">
                            </div>

                            <div class="form-group row mb-1">
                                <label class="col-2 fw-bold" for="VatTuCodeiput">Mã vật tư</label>
                                <select class="form-control col" id="VatTuCodeiput" name="IDVT">
                                    <option value=""></option>
                                      @if (vattu != null)
                                        {
                                            @foreach(var item in vattu)
                                            {
                                                <option value="@item.IDVT">@item.IDVT</option>
                                            }
                                        }
                                </select>
                                <label class="col-2 fw-bold" for="VatTuNameinput">Tên vật tư</label>
                                <select class="form-control col" id="VatTuNameinput">
                                    <option value=""></option>
                                      @if (vattu != null)
                                        {
                                            @foreach(var item in vattu)
                                            {
                                                <option value="@item.TenVatTu">@item.TenVatTu</option>
                                            }
                                        }
                                </select>
                            </div>

                            <div class="form-group row mb-1">
                                <label class="col-2 fw-bold" for="origininput">Nguồn gốc</label>
                                <select  class="form-control col" id="origininput">
                                    <option value=""></option>
                                     @if (ListXuatSu != null)
                                         {
                                             @foreach( var item in ListXuatSu)
                                             {
                                                 
                 
                                                     <option value="@item.IDXX" > @item.QuocGia </option>
  
          
     
                                             }
                                         }
                                </select>
                                <label class="col-2 fw-bold" for="composition">Đơn giá </label>
                                <input type="text" class="form-control col" id="composition" name="DonGia">
                            </div>

                            <div class="form-group row mb-1">
                                <label class="col-2 fw-bold" for="totalInput">Thành tiền</label>
                                <input type="text" class="form-control col" id="totalInput" name="ThanhTien">
                                <label class="col-2 fw-bold" for="expiryDateinput">Hạn sử dụng</label>
                                <input type="datetime" class="form-control col" id="expiryDateinput">
                            </div>

                            <div class="form-group row mb-1">
                                <label class="col-2 fw-bold" for="notesiput">Ghi chú</label>
                                <textarea class="form-control col" id="notesiput" name="GhiChu"></textarea>
                            </div>
                        </div>

                        <div class="col-3">
                                 <div id="pdfPreview" class="border rounded-3" style="height: 85%; width: 100%; display: none;">
                                    <iframe id="pdfViewer" src="" frameborder="0" style="width: 100%; height: 100%;"></iframe>
                                </div>
                                <img id="pdfPlaceholder" src="~/Img/pdf-2127829_640.png" class="border rounded-3" alt="" height="85%" width="100%">
                                <label class="btn mt-1 ms-4" style="background-color: #2fb388; color: white; border-color: #2fb388;">
                                    <i class="fas fa-upload"></i> Tải văn bản xác nhận
                                    <input type="file" class="form-control d-none" id="ChungtuFile" name="ChungtuFile" accept="application/pdf" onchange="previewPDF(event)">
                                </label>
                                <script>
                                    function previewPDF(event) {
                                    const fileInput = event.target;
                                    const file = fileInput.files[0];

                                    if (file && file.type === "application/pdf") {
                                        const fileURL = URL.createObjectURL(file);
                                        const pdfViewer = document.getElementById("pdfViewer");
                                        const pdfPreview = document.getElementById("pdfPreview");
                                        const pdfPlaceholder = document.getElementById("pdfPlaceholder");

                                        // Hiển thị PDF
                                        pdfViewer.src = fileURL;
                                        pdfPreview.style.display = "block";

                                        // Ẩn hình placeholder
                                        pdfPlaceholder.style.display = "none";
                                    } else {
                                        alert("Vui lòng chọn một tệp PDF hợp lệ.");
                                    }
                                }
                                </script>
                        </div>
                          <button type="submit" id="hiddenSubmit" style="display: none;"></button>
                    </form>
                </div>

                <div class="table-responsive border rounded-4 mt-2" style="font-size: small;">
                    <table class="table m-0 mt-2" id="vatTuTable">
                        <thead>
                            <tr>
                                <th></th>
                                <th>Mã vật tư</th>
                                <th>IDTL</th>
                                <th>IDNHC</th>
                                <th>IDNGC</th>
                                <th>IDXX</th>
                                <th>Tên vật tư</th>
                                <th>Đơn Giá</th>
                                <th>Hạn sử dụng</th>
                                <th>Số Lượng</th>
                                <th>Ghi chú</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (vattu != null)
                            {
                                @foreach(var item in vattu)
                                {
                                    <tr>
                                        <td><input type="radio" name="name" value="@item.IDVT" /></td>
                                        <td>@item.IDVT</td>
                                        <td>@item.IDTL</td>
                                        <td>@item.IDNHC</td>
                                        <td>@item.IDNGC</td>
                                        <td>@item.IDXX</td>
                                        <td>@item.TenVatTu</td>
                                        <td>@item.DonGia</td>
                                        <td>@item.HanSuDung</td>
                                        <td>@item.SoLuong</td>
                                        <td>@item.GhiChu</td>
                                    </tr>
                                }
                            }
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-outline-danger" data-bs-dismiss="modal">Đóng</button>
                <button type="button" class="btn custom-btn" onclick="triggerHiddenSubmit()">Lưu</button>
               <script>
                    function triggerHiddenSubmit() {
                        document.getElementById('hiddenSubmit').click();
                    }
                </script>

            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () { 
    const vatTuCodeSelect = document.getElementById('VatTuCodeiput');
    const vatTuNameSelect = document.getElementById('VatTuNameinput');
    const vatTuTable = document.getElementById('vatTuTable');
    const tableRows = vatTuTable.querySelectorAll('tbody tr'); 
    const quantityInput = document.getElementById('QuantityXN');
    const priceInput = document.getElementById('composition');
    const totalInput = document.getElementById('totalInput');
    const originInput = document.getElementById('origininput');

    // Hàm cập nhật trường thông tin
    function updateFields(row) {
        const fields = {
            vatTuCode: row.querySelector('td:nth-child(2)').textContent.trim(),
            vatTuName: row.querySelector('td:nth-child(7)').textContent.trim(),
            hanSuDung: row.querySelector('td:nth-child(9)').textContent.trim(),
            ghiChu: row.querySelector('td:nth-child(11)').textContent.trim(),
            donGia: row.querySelector('td:nth-child(8)').textContent.trim(),
            IDXX: row.querySelector('td:nth-child(6)').textContent.trim(),
            IDVT: row.querySelector('td:nth-child(2)').textContent.trim()
        };

        // Cập nhật giá trị vào form
        vatTuCodeSelect.value = fields.vatTuCode;
        vatTuNameSelect.value = fields.vatTuName;
        priceInput.value = fields.donGia;
        document.getElementById('expiryDateinput').value = fields.hanSuDung;

        // Cập nhật select option
        Array.from(originInput.options).forEach(option => {
            option.selected = option.value === fields.IDXX;
        });

        // Chọn radio button tương ứng
        const radioButton = row.querySelector(`input[type="radio"][name="name"][value="${fields.IDVT}"]`);
        if (radioButton) radioButton.checked = true;

        calculateTotal();
    }

    // Hàm tính tổng
    function calculateTotal() {
        const quantity = parseFloat(quantityInput.value) || 0;
        const price = parseFloat(priceInput.value) || 0;
        if (quantityInput.value.trim() === "") { 
        quantity = 1;
        quantityInput.value = 1; 
    }
        const total = quantity * price;
        totalInput.value = total; 
    }

    // Hàm cập nhật dữ liệu từ bảng
    function updateFieldsFromTable() {
        const selectedVatTuCode = vatTuCodeSelect.value.trim();
        const selectedVatTuName = vatTuNameSelect.value.trim();

        tableRows.forEach(row => {
            const vatTuCodeInRow = row.querySelector('td:nth-child(2)').textContent.trim();
            const vatTuNameInRow = row.querySelector('td:nth-child(7)').textContent.trim();

            if (selectedVatTuCode === vatTuCodeInRow || selectedVatTuName === vatTuNameInRow) {
                updateFields(row);
            }
        });
    }

    // Thêm sự kiện cho các radio button
    vatTuTable.addEventListener('click', function (event) {
        if (event.target.type === 'radio' && event.target.name === 'name') {
            const row = event.target.closest('tr');
            if (row) updateFields(row);
        }
    });

    // Thêm sự kiện khi thay đổi mã vật tư hoặc tên vật tư
    vatTuCodeSelect.addEventListener('change', updateFieldsFromTable);
    vatTuNameSelect.addEventListener('change', updateFieldsFromTable);

    // Thêm sự kiện tính tổng
    quantityInput.addEventListener('input', calculateTotal);
    priceInput.addEventListener('input', calculateTotal);

    // Khởi tạo
    updateFieldsFromTable();
});

</script>


 
  
</div>